## Лекция №9. Динамики Гамильтона и Ланжевена.
[[Лекция №8. MCMC|Продолжаем]] рассматривать методы сэмплирования.
Пусть плотность известна с точностью до const: $p(x) = \frac{\hat{p}(x)}{B}$

*Из физики:*
$H(x, v) = \Pi(x) + K(v) = Const$ - **гамильтониан**
$\Pi(x)$ - потенциальная энергия
$K(v)$ - кинетическая энергия
**Динамика Гамильтона (HD)**:
$\frac{dx}{dt} = \frac{dH}{dv}$
$\frac{dv}{dt} = - \frac{dH}{dx}$

*Применительно к нашей задаче, положим:*
$K(v) := \frac{||v||^2}{2}$ 
$\Pi(x) := -\log \hat{p}(x)$

*Алгоритм:*
1. $v_n$ сэмплируем из $N(v_n|0, I)$
2. $[x_n, v_n]$ -> HD -> $[x^{'}, v^{'}]$
3. $x_{n+1} := x^{'}$ повторить

*На выходе:*
$[x_1, v_1], ..., [x_n, v_n],  ...$ - МЦ

Такая МЦ явл-ся однородной (т.к. $q(x^{'}, v^{'}|x, v)$ - вообще детерминированный переход) и эргодичной (т.к. $q(x^{'}|x) > 0$), а $p(x)$ - стационарное распр-е (док-ся по опр-ю).

* \+ с помощью движения по линиям уровня, можем обойти все моды
* \+ значительно меньшая коррелляция между сэмплами
* \- увеличилось число сэмплируемых данных ($d$ -> $2d$)

MCMC ~ методы оптимизации 0-го порядка
HD ~ методы оптимизации 1-го порядка

---

*Но как делать динамику Гамильтона?*
Нужно решать дифф. ур., но они аналитически в общем случае не решаются.

*Решение:*
**Leap-frog integration (LF)** - численное интегрирование по некоторому временному интервалу $T$.
Обладает **св-вом сохранения объёма**, т.е. якобиан перехода с высокой точностью равен 1.
Похож на метод Рунге-Кутта 2-го порядка, потому что тоже использует промежуточное значение в точке $v_{t+\frac12}$. Доказано, что LF не накапливает ошибку относительно честной динамики, в отличии от метода Эйлера.

**Laigevin dynamics (LD)** - частный случай LF при $T = 1$.
Итоговая ф-ла: $x_1 = x_0 + \varepsilon v_0 + \frac{\varepsilon}{2} \log \hat{p} (x_0)$.
Похож на градиентный подъём (GA), но с добавлением шума определённой магнитуды. A это уже похоже на стохастический градиентный подъём (SGA).
Также можно считать стохастический градиент => **SGLD**.

*Хотим:*
Провести процедуру сэмплирования, используя LF, а точнее его частный случай LD. Притом аналогично MCMC: из $r(x^{'}|x)$ сэмплируем $x^{'}$ с вер-тью $A(x, x^{'})$, иначе реплецируем старое значение.

*На деле:*
В данном случае вместо $r(x^{'}|x)$  у нас детерминированная динамика Ланжевена. Но теперь теряется св-во стационарности $p(x)$. Если определённым образом скорректировать вер-ть $\hat{A}(x, x^{'})$, то стационарность возвращается (док-ся по опр-ю, но у ДП не получилось, ааа грустна). Но не гарантируется эргодичность. Поэтому в детерминированную эволюцию вносят элемент случайности (ресемплирование $v$). Тогда $q(x^{'}|x)>0$ => появляется эргодичность, но только по $x$, а большего нам и не надо!

Самый эффективный метод Монте-Карло для данных большой размерности. С подсчётом $\hat{A}(x, x^{'})$ всё равно возникают проблемы в высокоразмерных пр-вах, но это лучше, чем всё остальное.
